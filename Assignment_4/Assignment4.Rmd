---
title: "Assignment4"
output: html_document
---

## **Load Libraries**
```{r}

library(readr)
library(factoextra)
library(flexclust)
library(tidyverse)
library(caret)
library(dplyr)
library(ggplot2)

```
<br>

## **Import Data**
```{r}

Pharmaceuticals <- read_csv("Pharmaceuticals.csv")

```
*Data sourced from Canvas.*

<br>

## **Numerical Variables Only**
```{r}

sapply(Pharmaceuticals, class)
Pharmaceuticals_Num <- Pharmaceuticals[,3:11]
sapply(Pharmaceuticals_Num, class)

```
<br>

## **Normalize Data**
```{r}

set.seed(123)
summary(Pharmaceuticals_Num)
norm_model <- preProcess(Pharmaceuticals_Num, method = c("center", "scale"))
Pharmaceuticals_Norm <- predict(norm_model,Pharmaceuticals_Num)
summary(Pharmaceuticals_Norm)

```
<br>

## **Finding K**
```{r}

fviz_nbclust(Pharmaceuticals_Norm, kmeans, method = "wss") +
  geom_hline(yintercept = 80, linetype = 2, color = "royalblue", size = 0.5) +
  ggtitle("Elbow Method with k = 4 Highlighted")

fviz_nbclust(Pharmaceuticals_Norm, kmeans, method = "silhouette")

```
<br>

## **Clustering**
```{r}

distance <- get_dist(Pharmaceuticals_Norm)
fviz_dist(distance)

Pharmaceuticals_Clusters <- kmeans(Pharmaceuticals_Norm, centers = 4, nstart = 25)
Pharmaceuticals_Clusters$centers
Pharmaceuticals_Clusters$size

fviz_cluster(Pharmaceuticals_Clusters, data = Pharmaceuticals_Norm)

```
<br>

# **<span style="color:DarkBlue">Question A:</span>**
## **Justification of Choices**

#### - Normalization:  
I chose to use z-score ("center" and "scale") because the numerical variables have 
very different magnitudes and is recommended for k-means.

#### - Distance Metric:  
I chose to use Euclidean because it works well when variables are standardized 
and is recommended for k-means.

#### - Clustering Algorithm:  
I chose to use kmeans() and not kcca because we are using numerical variables only 
and are using euclidean distance.

#### - Number of Clusters:  
I chose 4 by using the "wss" method because the plot shows a clear bend at k = 4 
and the shapes of the clusters in k = 4 logically fits the data more than k = 5 
from the "silhouette" method.

## **Cluster Interpretation for Numerical Variable**
```{r}

Pharmaceuticals_Num_Clusters <- Pharmaceuticals[,3:11]
Pharmaceuticals_Num_Clusters$Cluster <- Pharmaceuticals_Clusters$cluster

Clusters <- split(Pharmaceuticals_Num_Clusters, Pharmaceuticals_Num_Clusters$Cluster)

print(Clusters)

```
<br>

### Market_Cap by Cluster
```{r}

ggplot(Pharmaceuticals_Num_Clusters, aes(x = factor(Cluster), y = Market_Cap, fill = factor(Cluster))) +
  geom_bar(stat = "summary", fun = "mean") +
  labs(title = "Average Market_Cap by Cluster", x = "Cluster", y = "Market_Cap") +
  theme_minimal() +
  theme(legend.position = "none")

```

### Beta by Cluster
```{r}

ggplot(Pharmaceuticals_Num_Clusters, aes(x = factor(Cluster), y = Beta, fill = factor(Cluster))) +
  geom_bar(stat = "summary", fun = "mean") +
  labs(title = "Average Beta by Cluster", x = "Cluster", y = "Beta") +
  theme_minimal() +
  theme(legend.position = "none")

```

### PE_Ratio by Cluster
```{r}

ggplot(Pharmaceuticals_Num_Clusters, aes(x = factor(Cluster), y = PE_Ratio, fill = factor(Cluster))) +
  geom_bar(stat = "summary", fun = "mean") +
  labs(title = "Average PE_Ratio by Cluster", x = "Cluster", y = "PE_Ratio") +
  theme_minimal() +
  theme(legend.position = "none")

```

### ROE by Cluster
```{r}

ggplot(Pharmaceuticals_Num_Clusters, aes(x = factor(Cluster), y = ROE, fill = factor(Cluster))) +
  geom_bar(stat = "summary", fun = "mean") +
  labs(title = "Average ROE by Cluster", x = "Cluster", y = "ROE") +
  theme_minimal() +
  theme(legend.position = "none")

```

### ROA by Cluster
```{r}

ggplot(Pharmaceuticals_Num_Clusters, aes(x = factor(Cluster), y = ROA, fill = factor(Cluster))) +
  geom_bar(stat = "summary", fun = "mean") +
  labs(title = "Average ROA by Cluster", x = "Cluster", y = "ROA") +
  theme_minimal() +
  theme(legend.position = "none")

```

### Asset_Turnover by Cluster
```{r}

ggplot(Pharmaceuticals_Num_Clusters, aes(x = factor(Cluster), y = Asset_Turnover, fill = factor(Cluster))) +
  geom_bar(stat = "summary", fun = "mean") +
  labs(title = "Average Asset_Turnover by Cluster", x = "Cluster", y = "Asset_Turnover") +
  theme_minimal() +
  theme(legend.position = "none")

```

### Leverage by Cluster
```{r}

ggplot(Pharmaceuticals_Num_Clusters, aes(x = factor(Cluster), y = Leverage, fill = factor(Cluster))) +
  geom_bar(stat = "summary", fun = "mean") +
  labs(title = "Average Leverage by Cluster", x = "Cluster", y = "Leverage") +
  theme_minimal() +
  theme(legend.position = "none")

```

### Rev_Growth by Cluster
```{r}

ggplot(Pharmaceuticals_Num_Clusters, aes(x = factor(Cluster), y = Rev_Growth, fill = factor(Cluster))) +
  geom_bar(stat = "summary", fun = "mean") +
  labs(title = "Average Rev_Growth by Cluster", x = "Cluster", y = "Rev_Growth") +
  theme_minimal() +
  theme(legend.position = "none")

```

### Net_Profit_Margin by Cluster
```{r}

ggplot(Pharmaceuticals_Num_Clusters, aes(x = factor(Cluster), y = Net_Profit_Margin, fill = factor(Cluster))) +
  geom_bar(stat = "summary", fun = "mean") +
  labs(title = "Average Net_Profit_Margin by Cluster", x = "Cluster", y = "Net_Profit_Margin") +
  theme_minimal() +
  theme(legend.position = "none")

```

# **<span style="color:DarkBlue">Question B:</span>**
### **Interpretation**

#### Cluster 1:  
- Has the highest average Market Cap  
- Has the highest average ROE  
- Has the highest average ROA  
- Has the highest average Net Profit Margin  
- Has the least average Leverage  

Interpretation: Stable, efficient and highly profitable  

#### Cluster 2:  
- Has the highest average PE Ratio  
- Has high average Beta  
- Has low average Leverage  
- Has low average Rev Growth  
- Has the least average ROE  
- Has the least average ROA  
- Has the least average Net Profit Margin  

Interpretation: Low Growth, not very efficient, and not very profitable  

#### Cluster 3:  
- Has the highest average Beta  
- Has the highest average Leverage  
- Has the highest average Rev Growth  
- Has low average ROE  
- Has low average ROA  
- Has the least average Market Cap  
- Has the least average Asset Turnover  

Interpretation: Growing, not very efficient, and less profitable  

#### Cluster 4:  
- Has high average Net Profit Margin  
- Has low average Leverage  
- Has the least average Beta  
- Has the least average Rev Growth  

Interpretation: Stable, efficient, and profitable  

## **Cluster Interpretation for Categorical Variable**
```{r}

Pharmaceuticals_Clusters$cluster
Pharmaceuticals_Interp <- Pharmaceuticals[,-(3:11)]
Pharmaceuticals_Interp$Cluster <- Pharmaceuticals_Clusters$cluster

Clusters <- split(Pharmaceuticals_Interp, Pharmaceuticals_Interp$Cluster)

print(Clusters)

```
<br>

### Median Recommendation by Cluster
```{r}

ggplot(Pharmaceuticals_Interp, aes(x = factor(Cluster), fill = Median_Recommendation)) +
  geom_bar() +
  labs(title = "Distribution of Median Recommendation by Cluster", x = "Cluster", y = "Count") +
  theme_minimal()

```

### Location by Cluster
```{r}

ggplot(Pharmaceuticals_Interp, aes(x = factor(Cluster), fill = Location)) +
  geom_bar() +
  labs(title = "Distribution of Location by Cluster", x = "Cluster", y = "Count") +
  theme_minimal()

```

### Exchange by Cluster
```{r}

ggplot(Pharmaceuticals_Interp, aes(x = factor(Cluster), fill = Exchange)) +
  geom_bar() +
  labs(title = "Distribution of Exchange by Cluster", x = "Cluster", y = "Count") +
  theme_minimal()

```

# **<span style="color:DarkBlue">Question C:</span>**
### **Interpretation**

#### Cluster 1:  
- Has no Sells  
- Mostly USA  
- All NYSE  

#### Cluster 2:  
- Has no Sells  
- Has least USA  
- All NYSE  

#### Cluster 3:  
- Has the highest amount of Moderate Buys  
- Mostly USA  
- Has AMEX  
- Has NASDAQ  

#### Cluster 4:  
- Has the highest amount of Holds  
- Has Strong Buys  
- Mostly USA  
- All NYSE  
<br>

#### Overall Interpretation:  
There is not many strong patterns in the categorical values. 
Mostly due to them not being used in the formation of the clusters. 
The Median Recommendation slightly reflects the stability and growth found in the numerical interpretation. 
Cluster 3 is the only cluster with data outside the NYSE.  

# **<span style="color:DarkBlue">Question D:</span>**
## **Cluster Names**

#### - Cluster 1:  Strong Earners  

#### - Cluster 2:  Weak Earners  

#### - Cluster 3:  Growing Earners  

#### - Cluster 4:  Stable Earners  

```{r}

Cluster_Names <- c("Strong Earners", "Weak Earners", "Growing Earners", "Stable Earners")
fviz_cluster(Pharmaceuticals_Clusters, data = Pharmaceuticals_Norm) +
  scale_fill_discrete(name = "Cluster Names", labels = Cluster_Names)
  
```

