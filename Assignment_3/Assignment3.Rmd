---
title: "Assignment3"
output:
  html_document: default
---

## **Load Libraries**
```{r}

library(class)
library(caret)
library(gmodels)
library(readr)
library(reshape2)
library(e1071)

```
<br>

## **Import Data**
```{r}

UniversalBank <- read_csv("UniversalBank.csv")

```
*Data sourced from Canvas.*

<br>

## **Split Data**
```{r}

set.seed(123)
Index_Train <- createDataPartition(UniversalBank$`Personal Loan`, p=0.6, list = F)
Train <- UniversalBank[Index_Train,]
Valid <- UniversalBank[-Index_Train,]

```
<br>

# **<span style="color:DarkBlue">Question A:</span>**
## **Training Pivot Table**
```{r}

Train_Melt <- melt(Train, id.vars = c("CreditCard", "Online", "Personal Loan"))
Pivot_Table <- dcast(Train_Melt, CreditCard + `Personal Loan` ~ Online, fun.aggregate = length)
print(Pivot_Table)

```
<br>

# **<span style="color:DarkBlue">Question B:</span>**
## **Probability**

$P(Personal Loan = 1|CreditCard = 1, Online = 1)$
```{r}

Prob_Online <- (Pivot_Table[4,4] / (Pivot_Table[3,4] + Pivot_Table[4,4]))
print(Prob_Online)
print(paste("If a customer who owns a bank credit card and is actively using online banking services.",
            "The probability that this customer will accept the loan offer is", Prob_Online * 100, "%"))

```
<br>

# **<span style="color:DarkBlue">Question C:</span>**
## **More Training Pivot Tables**
```{r}

Train_Melt_Online <- melt(Train, id.vars = c("Online", "Personal Loan"))
Pivot_Table_Online <- dcast(Train_Melt_Online, `Personal Loan` ~ Online, fun.aggregate = length)
print("Personal Loan (rows) as a function of Online (columns):")
print(Pivot_Table_Online)

Train_Melt_CreditCard <- melt(Train, id.vars = c("CreditCard", "Personal Loan"))
Pivot_Table_CreditCard <- dcast(Train_Melt_CreditCard, `Personal Loan` ~ CreditCard, fun.aggregate = length)
print("Personal Loan (rows) as a function of CreditCard (columns):")
print(Pivot_Table_CreditCard)

```
<br>

# **<span style="color:DarkBlue">Question D:</span>**
## **More Probabilities**

i. $P(CreditCard = 1 | Personal Loan = 1)$
```{r}
Prob_CC_PL <- (Pivot_Table_CreditCard[2,3]/(Pivot_Table_CreditCard[2,2]+Pivot_Table_CreditCard[2,3]))
print(Prob_CC_PL)
```

ii. $P(Online = 1 | Personal Loan = 1)$
```{r}
Prob_O_PL <- (Pivot_Table_Online[2,3]/(Pivot_Table_Online[2,2]+Pivot_Table_Online[2,3]))
print(Prob_O_PL)
```

iii. $P(Personal Loan = 1)$
```{r}
Prob_PL <- ((Pivot_Table_CreditCard[2,2]+Pivot_Table_CreditCard[2,3])/
              (Pivot_Table_Online[1,2]+Pivot_Table_Online[2,2]+Pivot_Table_Online[1,3]+Pivot_Table_Online[2,3]))
Prob_PL2 <- ((Pivot_Table_Online[2,2]+Pivot_Table_Online[2,3])/
              (Pivot_Table_Online[1,2]+Pivot_Table_Online[2,2]+Pivot_Table_Online[1,3]+Pivot_Table_Online[2,3]))
if(Prob_PL == Prob_PL2) {
  print(Prob_PL)
}
```

iv. $P(CreditCard = 1 | Personal Loan = 0)$
```{r}
Prob_CC_PL0 <- (Pivot_Table_CreditCard[1,3]/(Pivot_Table_CreditCard[1,2]+Pivot_Table_CreditCard[1,3]))
print(Prob_CC_PL0)
```

v. $P(Online = 1 | Personal Loan = 0)$
```{r}
Prob_O_PL0 <- (Pivot_Table_Online[1,3]/(Pivot_Table_Online[1,2]+Pivot_Table_Online[1,3]))
print(Prob_O_PL0)
```

vi. $P(Personal Loan = 0)$
```{r}
Prob_PL0 <- ((Pivot_Table_CreditCard[1,2]+Pivot_Table_CreditCard[1,3])/
              (Pivot_Table_Online[1,2]+Pivot_Table_Online[2,2]+Pivot_Table_Online[1,3]+Pivot_Table_Online[2,3]))
Prob_PL02 <- ((Pivot_Table_Online[1,2]+Pivot_Table_Online[1,3])/
              (Pivot_Table_Online[1,2]+Pivot_Table_Online[2,2]+Pivot_Table_Online[1,3]+Pivot_Table_Online[2,3]))
if(Prob_PL0 == Prob_PL02 && Prob_PL0 == 1-Prob_PL) {
  print(Prob_PL0)
}
```
<br>

# **<span style="color:DarkBlue">Question E:</span>**
## **Naive Bayes**

$P(Personal Loan = 1|CreditCard = 1, Online = 1)$
```{r}

# P(CreditCard = 1 | Personal Loan = 1) * P(Online = 1 | Personal Loan = 1) * P(Personal Loan = 1)
Prob_CC_PL_O_PL_PL <- (Prob_CC_PL*Prob_O_PL*Prob_PL)
# P(CreditCard = 1 | Personal Loan = 0) * P(Online = 1 | Personal Loan = 0) * P(Personal Loan = 0)
Prob_CC_PL0_O_PL0_PL0 <- (Prob_CC_PL0*Prob_O_PL0*Prob_PL0)
# P(CreditCard = 1, Online = 1)
Prob_CC_O <- Prob_CC_PL_O_PL_PL+Prob_CC_PL0_O_PL0_PL0
# P(Personal Loan = 1|CreditCard = 1, Online = 1)
Prob_CC_O_PL <- Prob_CC_PL_O_PL_PL/Prob_CC_O
print(Prob_CC_O_PL)

```
<br>

# **<span style="color:DarkBlue">Question F:</span>**
## **Compare Values**

```{r}
print(paste("B:", Prob_Online))
print(paste("E:", Prob_CC_O_PL))
```
The Naive Bayes estimate is slightly higher than the original estimate.
When considering only the training data the first model would be considered a <u>**more accurate**</u> estimate.
But, when making predictions on new unseen data the Naive Bayes estimate would likely be more accurate.

<br>

# **<span style="color:DarkBlue">Question G:</span>**
## **Naive Bayes in R**
These values are needed to compute $P(Personal Loan = 1|CreditCard = 1, Online = 1)$:

- $P(CreditCard = 1 | Personal Loan = 1)$
- $P(Online = 1 | Personal Loan = 1)$
- $P(Personal Loan = 1)$
- $P(CreditCard = 1 | Personal Loan = 0)$
- $P(Online = 1 | Personal Loan = 0)$
- $P(Personal Loan = 0)$

```{r}

nb_model <- naiveBayes(`Personal Loan` ~ CreditCard + Online, data = Train)
New_Customer <- data.frame(CreditCard = 1, Online = 1)
Prob_New <- predict(nb_model, New_Customer, type = "raw")
print(Prob_New[1,2])

```
This value (11.57%) is almost the same as the value found in E (11.05%).

<br>
